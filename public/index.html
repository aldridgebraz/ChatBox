<!doctype html>
<html>
	<head>
	<title>ChatBox</title>
	<link rel="stylesheet" type="text/css" href="index.css">
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.js"></script>
	<script type="text/javascript" src="socket.io/socket.io.js"></script>
	</head>

	<body>
		<div id="chathistory">
		</div>
		
		<form action="">
			<input type="text" id="m" autocomplete="off" />
			<button type="submit">Send</button>
		</form>
		
		<script type="text/javascript">
			var socket = io();
			var username = null;
			socket.on("connect", function() {
				username = prompt("Please enter your username");
				if (username != null) {
					socket.emit("new user", username);
				}
			});
			
			$("form").submit(function() {
				socket.emit("chat message", $("#m").val());
				$("#chathistory").append($("<p>").text($("#m").val()));
				$('html, body').scrollTop( $(document).height() );
				$("#m").val("");
				return false;
			});
			
			socket.on("chat message", function(msg) {
				$("#chathistory").append($("<p>").text(msg));
				$('html, body').scrollTop( $(document).height() );
			});
			
			socket.on("new user", function(username) {
				$("#chathistory").append($("<p>").text(username + " has connected"));
				$('html, body').scrollTop( $(document).height() );
			});
			
			socket.on("user left", function(username) {
				$("#chathistory").append($("<p>").text(username + " has disconnected"));
				$('html, body').scrollTop( $(document).height() );
			});
			
		</script>
	</body>
</html>